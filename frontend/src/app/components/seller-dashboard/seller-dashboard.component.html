<!-- seller-dashboard.component.html -->
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10">
      <h2 class="text-center mb-4">Seller Dashboard</h2>

      <form
        [formGroup]="productForm"
        (ngSubmit)="submitProduct()"
        novalidate
        class="p-4 rounded shadow-sm"
      >
        <div class="mb-3">
          <label class="form-label">Product Name</label>
          <input
            formControlName="name"
            type="text"
            class="form-control custom-width"
            [class.is-invalid]="
              productForm.get('name')?.invalid && productForm.get('name')?.touched
            "
          />
          <div
            *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched"
            class="invalid-feedback"
          >
            Name is required.
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea
            formControlName="description"
            class="form-control custom-width"
            [class.is-invalid]="
              productForm.get('description')?.invalid && productForm.get('description')?.touched
            "
            style="width: 100%; height: 120px; resize: none"
          ></textarea>
          <div
            *ngIf="
              productForm.get('description')?.invalid && productForm.get('description')?.touched
            "
            class="invalid-feedback"
          >
            Description is required.
          </div>
        </div>

        <div class="mb-3 custom-radio-group">
          <label class="form-label d-block mb-2">Category</label>
          <div class="d-flex flex-wrap gap-3">
            <label
              *ngFor="let cat of categories"
              class="custom-radio-label"
              [ngClass]="{ 'selected-category': selectedCategoryId === cat.id }"
              style="min-width: 120px"
            >
              <input type="radio" formControlName="category" [value]="cat.id" />
              <span class="custom-radio-text">{{ cat.name }}</span>
            </label>
          </div>
          <div
            *ngIf="productForm.get('category')?.invalid && productForm.get('category')?.touched"
            class="invalid-feedback d-block"
          >
            Category is required.
          </div>
        </div>

        <div class="form-control-group">
          <div class="mb-3 d-flex gap-3">
            <div class="flex-fill">
              <label class="form-label">Price</label>
              <input
                formControlName="price"
                type="number"
                class="form-control custom-width"
                [class.is-invalid]="
                  productForm.get('price')?.invalid && productForm.get('price')?.touched
                "
              />
              <div
                *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched"
                class="invalid-feedback"
              >
                Price must be greater than 0.
              </div>
            </div>

            <div class="flex-fill">
              <label class="form-label">Quantity</label>
              <input
                formControlName="quantity"
                type="number"
                class="form-control custom-width"
                [class.is-invalid]="
                  productForm.get('quantity')?.invalid && productForm.get('quantity')?.touched
                "
              />
              <div
                *ngIf="productForm.get('quantity')?.invalid && productForm.get('quantity')?.touched"
                class="invalid-feedback"
              >
                Quantity must be at least 1.
              </div>
            </div>
          </div>
        </div>

        <!-- Image media upload -->
        <div class="card my-3">
          <div class="card-header">Media Management</div>
          <div class="card-body">
            <!-- Drag & Drop Upload Area -->
            <div
              class="upload-area drop-zone"
              (click)="fileInput.click()"
              (drop)="onDrop($event)"
              (dragover)="onDragOver($event)"
              [class.active]="isDragActive"
              (dragleave)="isDragActive = false"
            >
              <div class="drop-zone-content text-center">
                <i class="fas fa-upload fa-2x text-primary mb-2"></i>
                <div>Drag & drop images here or click to select files</div>
                <input
                  #fileInput
                  type="file"
                  multiple
                  accept="image/*"
                  class="d-none"
                  (change)="onFilesSelected($event)"
                />
              </div>
            </div>

            <div *ngIf="imageValidationError" class="text-danger">
              {{ imageValidationError }}
            </div>

            <!-- Preview Area: show all selected images -->
            <div class="preview-gallery d-flex flex-wrap gap-2 mt-3">
              <div *ngFor="let img of imagePreviews; let i = index" class="position-relative">
                <img [src]="img.dataUrl" class="img-thumbnail" width="120" />
                <button
                  class="btn btn-danger btn-sm position-absolute top-0 end-0 btn-small-x"
                  (click)="removeImage(i)"
                >
                  ✖
                </button>
                <button
                  class="btn btn-secondary btn-sm position-absolute bottom-0 end-0"
                  (click)="moveImageUp(i)"
                  *ngIf="i > 0"
                >
                  ↑
                </button>
                <button
                  class="btn btn-secondary btn-sm position-absolute bottom-0 start-0"
                  (click)="moveImageDown(i)"
                  *ngIf="i < imagePreviews.length - 1"
                >
                  ↓
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- <div class="mb-3">
        <label class="form-label">Image</label>
        <input type="file" (change)="onImageChange($event)" accept="image/*" class="form-control custom-width" />
        <div *ngIf="productForm.get('image')?.invalid && productForm.get('image')?.touched" class="text-danger">
          Image is required.
        </div>
          <div *ngIf="imageValidationError" class="text-danger">
              {{ imageValidationError }}
          </div>
        <div *ngIf="imagePreview" class="mt-2">
          <img [src]="imagePreview" alt="Image preview" class="img-thumbnail" style="max-width: 200px;" />
          <button type="button" class="btn btn-danger btn-sm mt-1" (click)="removeImage()">Remove Image</button>
        </div>
      </div> -->

        <button type="submit" class="btn btn-primary">Save Product</button>
        <button type="button" class="btn btn-secondary ms-2" (click)="resetForm()">Cancel</button>
      </form>

      <hr />

      <h3>Products List</h3>
      <ul class="list-group">
        <li class="list-group-item" *ngFor="let product of userProducts; let i = index">
          <div class="d-flex align-items-center">
            <img
              *ngIf="product.images && product.images.length > 0"
              [src]="product.images[0]"
              alt="Product Image"
              style="height: 50px; width: 50px; object-fit: cover"
              class="me-3"
            />
            <div class="flex-grow-1">
              <strong>{{ product.name }}</strong
              ><br />
              {{ product.description }}<br />
              €{{ product.price }}
            </div>
            <button class="btn btn-sm btn-warning me-2" (click)="editProduct(i)">Edit</button>
            <button class="btn btn-sm btn-danger" (click)="deleteProduct(i)">Delete</button>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>
